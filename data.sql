CREATE TABLE CLIENTS(
	ID NUMBER,
	LASTNAME VARCHAR2(50 CHAR),
	NAME VARCHAR2(50 CHAR),
	MIDDLENAME VARCHAR2(50 CHAR),
	AREA NUMBER
);

CREATE TABLE AREA(
	ID NUMBER,
	TEXT VARCHAR2(50 CHAR)
);

CREATE TABLE ORDERS(
	ID NUMBER,
	CLIENT_ID NUMBER,
	ORDER_TEXT VARCHAR2 (100 CHAR),
	SUM NUMBER
);

INSERT INTO CLIENTS (ID, LASTNAME, MIDDLENAME, NAME, AREA) VALUES (1, 'ИВАНОВ', 'НИКИТА', 'ДМИТРИЕВИЧ', 1);
INSERT INTO CLIENTS (ID, LASTNAME, MIDDLENAME, NAME, AREA) VALUES (2, 'СИДОРОВ', 'РУСЛАН', 'НИКОЛАЕВИЧ', 5);
INSERT INTO CLIENTS (ID, LASTNAME, MIDDLENAME, NAME, AREA) VALUES (3, 'МЕЛЕХИН', 'ИВАН', 'ПЕТРОВИЧ', 4);
INSERT INTO CLIENTS (ID, LASTNAME, MIDDLENAME, NAME, AREA) VALUES (4, 'ПЕТРОВ', 'ДМИТРИЙ', 'РУСЛАНОВИЧ', 3);
INSERT INTO CLIENTS (ID, LASTNAME, MIDDLENAME, NAME, AREA) VALUES (5, 'МИХАЙЛОВ', 'ПАВЕЛ', 'ПАВЛОВИЧ', 2);
INSERT INTO CLIENTS (ID, LASTNAME, MIDDLENAME, NAME, AREA) VALUES (6, 'КАРПОВ', 'МИХАИЛ', 'МИХАЙЛОВИЧ', 1);
INSERT INTO CLIENTS (ID, LASTNAME, MIDDLENAME, NAME, AREA) VALUES (7, 'РЫБКИН', 'ИВАН', 'АНАТОЛЬЕВИЧ', 6);
INSERT INTO CLIENTS (ID, LASTNAME, MIDDLENAME, NAME, AREA) VALUES (8, 'НИКОЛАЕВ', 'АРКАДИЙ', 'ВАЛЕНТИНОВИЧ', 3);
INSERT INTO CLIENTS (ID, LASTNAME, MIDDLENAME, NAME, AREA) VALUES (9, 'ВАСИЛЬЕВ', 'ПЕТР', 'АРКАДЬЕВИЧ', 1);
INSERT INTO CLIENTS (ID, LASTNAME, MIDDLENAME, NAME, AREA) VALUES (10, 'ФИЛЬКИН', 'ИВАН', 'ФЕДОРОВИЧ', 2);

INSERT INTO AREA (ID, TEXT) VALUES (1, 'СЫКТЫВКАР');
INSERT INTO AREA (ID, TEXT) VALUES (2, 'УСТЬ-КУЛОМ');
INSERT INTO AREA (ID, TEXT) VALUES (3, 'УСТЬ-ВЫМЬ');
INSERT INTO AREA (ID, TEXT) VALUES (4, 'СОСНОГОРСК');
INSERT INTO AREA (ID, TEXT) VALUES (5, 'УХТА');
INSERT INTO AREA (ID, TEXT) VALUES (6, 'ВОРКУТА');

INSERT INTO ORDERS (ID, CLIENT_ID, ORDER_TEXT, SUM) VALUES (1, 1, 'ПОКУПКА ЧЕГО-ТО', 100);
INSERT INTO ORDERS (ID, CLIENT_ID, ORDER_TEXT, SUM) VALUES (2, 2, 'ПОКУПКА ЧЕГО-ТО', 4568);
INSERT INTO ORDERS (ID, CLIENT_ID, ORDER_TEXT, SUM) VALUES (3, 10, 'ПОКУПКА ЧЕГО-ТО', 100);
INSERT INTO ORDERS (ID, CLIENT_ID, ORDER_TEXT, SUM) VALUES (4, 8, 'ПОКУПКА ЧЕГО-ТО', 100);
INSERT INTO ORDERS (ID, CLIENT_ID, ORDER_TEXT, SUM) VALUES (5, 8, 'ПОКУПКА ЧЕГО-ТО', 230);
INSERT INTO ORDERS (ID, CLIENT_ID, ORDER_TEXT, SUM) VALUES (6, 1, 'ПОКУПКА ЧЕГО-ТО', 100);
INSERT INTO ORDERS (ID, CLIENT_ID, ORDER_TEXT, SUM) VALUES (7, 2, 'ПОКУПКА ЧЕГО-ТО', 135);
INSERT INTO ORDERS (ID, CLIENT_ID, ORDER_TEXT, SUM) VALUES (8, 6, 'ПОКУПКА ЧЕГО-ТО', 100);
INSERT INTO ORDERS (ID, CLIENT_ID, ORDER_TEXT, SUM) VALUES (9, 1, 'ПОКУПКА ЧЕГО-ТО', 569);
INSERT INTO ORDERS (ID, CLIENT_ID, ORDER_TEXT, SUM) VALUES (10, 10, 'ПОКУПКА ЧЕГО-ТО', 100);
INSERT INTO ORDERS (ID, CLIENT_ID, ORDER_TEXT, SUM) VALUES (11, 3, 'ПОКУПКА ЧЕГО-ТО', 100);
INSERT INTO ORDERS (ID, CLIENT_ID, ORDER_TEXT, SUM) VALUES (12, 8, 'ПОКУПКА ЧЕГО-ТО', 100);
INSERT INTO ORDERS (ID, CLIENT_ID, ORDER_TEXT, SUM) VALUES (13, 9, 'ПОКУПКА ЧЕГО-ТО', 3526);
INSERT INTO ORDERS (ID, CLIENT_ID, ORDER_TEXT, SUM) VALUES (14, 1, 'ПОКУПКА ЧЕГО-ТО', 100);
INSERT INTO ORDERS (ID, CLIENT_ID, ORDER_TEXT, SUM) VALUES (15, 2, 'ПОКУПКА ЧЕГО-ТО', 25);
INSERT INTO ORDERS (ID, CLIENT_ID, ORDER_TEXT, SUM) VALUES (16, 1, 'ПОКУПКА ЧЕГО-ТО', 7879);
INSERT INTO ORDERS (ID, CLIENT_ID, ORDER_TEXT, SUM) VALUES (17, 10, 'ПОКУПКА ЧЕГО-ТО', 785);
INSERT INTO ORDERS (ID, CLIENT_ID, ORDER_TEXT, SUM) VALUES (18, 7, 'ПОКУПКА ЧЕГО-ТО', 100);
INSERT INTO ORDERS (ID, CLIENT_ID, ORDER_TEXT, SUM) VALUES (19, 5, 'ПОКУПКА ЧЕГО-ТО', 124);
INSERT INTO ORDERS (ID, CLIENT_ID, ORDER_TEXT, SUM) VALUES (20, 9, 'ПОКУПКА ЧЕГО-ТО', 100);
INSERT INTO ORDERS (ID, CLIENT_ID, ORDER_TEXT, SUM) VALUES (21, 8, 'ПОКУПКА ЧЕГО-ТО', 245);
INSERT INTO ORDERS (ID, CLIENT_ID, ORDER_TEXT, SUM) VALUES (22, 7, 'ПОКУПКА ЧЕГО-ТО', 7869);
INSERT INTO ORDERS (ID, CLIENT_ID, ORDER_TEXT, SUM) VALUES (23, 11, 'ПОКУПКА ЧЕГО-ТО', 254);
INSERT INTO ORDERS (ID, CLIENT_ID, ORDER_TEXT, SUM) VALUES (24, 10, 'ПОКУПКА ЧЕГО-ТО', 2452);
INSERT INTO ORDERS (ID, CLIENT_ID, ORDER_TEXT, SUM) VALUES (25, 1, 'ПОКУПКА ЧЕГО-ТО', 22137);

CREATE OR REPLACE FUNCTION FUN
(V1 IN VARCHAR2, V2 IN VARCHAR2, V3 IN VARCHAR2)
RETURN VARCHAR2
IS
BEGIN
    RETURN V1 || ' ' || V2 || ' ' || V3;
END;

CREATE OR REPLACE FUNCTION FUN
(V1 IN NUMBER)
RETURN VARCHAR2
IS T VARCHAR2(30);
BEGIN
    SELECT TEXT INTO T FROM AREA WHERE V1=ID;
    RETURN T;
END;

CREATE OR REPLACE PROCEDURE PROC
IS N NUMBER;
BEGIN
    N:=123||'R';
END;

CREATE OR REPLACE PROCEDURE PROC
IS
N NUMBER;
V1 VARCHAR2(900);
V2 VARCHAR2(900);
BEGIN
    N:=123||'R';
    EXCEPTION WHEN OTHERS THEN
    V1:=SQLCODE;
    V2:=substr(SQLERRM,1,900);
    INSERT INTO ERRORS(ERRORMESSAGE) VALUES (V1 ||' '||V2);
END;

CREATE OR REPLACE PROCEDURE PROC
IS  
    CURSOR CUR IS SELECT * FROM CLIENTS;
    C_ROW CUR%ROWTYPE;
    SUMM NUMBER;
BEGIN
    OPEN CUR;
  LOOP
    FETCH CUR into C_ROW;
    exit when CUR%NOTFOUND;
    
    select NVL(sum(SUM), 0) into summ from orders where client_id = C_ROW.id;
    insert into errors(id, ERRORMESSAGE) values (C_ROW.id, summ);
  END LOOP;
  CLOSE CUR;
END;

SELECT LASTNAME, AREA, COUNT(*)
FROM CLIENTS
GROUP BY LASTNAME, AREA;

CREATE OR REPLACE PROCEDURE PROC(A IN NUMBER, L IN VARCHAR2)
IS CURSOR CUR IS SELECT ROWID, AREA, LASTNAME FROM CLIENTS WHERE AREA=A AND LASTNAME=L AND ROWNUM=1;
BEGIN
	FOR
	C IN CUR
	LOOP
		DELETE FROM CLIENTS WHERE AREA=C.AREA AND LASTNAME=C.LASTNAME AND ROWID<>C.ROWID;
	END LOOP;
END;